# fpsd.yml — Face Puncher Supreme configuration
#
# All values below are the defaults. Uncomment and modify as needed.
# CLI flags override config file values when both are specified.

# Network — listen address in host:port format.
# Use "0.0.0.0:18737" to accept connections from other devices on the LAN.
listen: ":18737"

# Logging — directory for rotated log files. Set to "" to disable file logging.
log_dir: "logs"

# Verbose — enable DEBUG-level logging (full headers, byte counts, timing).
verbose: false

# Data directory — where blocklist.db and stats.db are stored.
data_dir: "."

# Blocklist URLs — Pi-hole compatible blocklists. Comment out any you don't want.
blocklist_urls:
  - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
  - https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/adblock/pro.txt
  - https://urlhaus.abuse.ch/downloads/hostfile/
  - https://big.oisd.nl/

# Inline blocklist — individual domains to block without needing a downloaded list.
# These are merged with URL-sourced domains at startup.
blocklist:
  - news.iadsdk.apple.com
  - news-events.apple.com
  - news-app-events.apple.com

# Allowlist — domains that are never blocked, even if they appear in blocklists.
# Supports exact match and suffix match (*.example.com matches all subdomains).
# Allowlist takes priority over both URL-sourced and inline blocklist entries.
allowlist:
  - registry.api.cnn.io
  - cdn.optimizely.com
  - "*.cnn.io"

# Timeouts — Go duration strings (e.g., "5s", "1m", "2m30s").
timeouts:
  shutdown: "5s"       # graceful shutdown deadline
  connect: "10s"       # upstream TCP dial timeout
  read_header: "10s"   # client request header read timeout

# Statistics — in-memory counters flushed to SQLite for persistence.
stats:
  enabled: true          # set to false to disable stats collection entirely
  flush_interval: "60s"  # how often in-memory counters are flushed to stats.db

# Transparent proxy — accepts iptables-redirected HTTP/HTTPS traffic.
# Requires iptables REDIRECT rules to send port 80/443 traffic to these ports.
# See README or spec 010 for iptables configuration examples.
transparent:
  enabled: true
  http_addr: ":18780"    # Transparent HTTP port (iptables redirects port 80 here)
  https_addr: ":18443"   # Transparent HTTPS port (iptables redirects port 443 here)

# MITM — per-domain TLS interception for content-level ad blocking.
# Requires CA cert: run `fpsd generate-ca` first, then install CA on clients.
mitm:
  ca_cert: "ca-cert.pem"
  ca_key: "ca-key.pem"
  domains:
    - www.reddit.com
    - old.reddit.com
    - gql-fed.reddit.com

# Content filter plugins — site-specific filters for MITM'd domains.
# Each plugin targets a set of domains and operates in "intercept" or "filter" mode.
plugins:
  reddit-promotions:
    enabled: true
    mode: "filter"           # "intercept" captures traffic; "filter" applies rules
    placeholder: "visible"   # "visible", "comment", or "none"
    domains:
      - www.reddit.com
      - gql-fed.reddit.com
    options:
      log_matches: true

# Dashboard — web-based monitoring UI at /fps/dashboard.
# Both username and password must be set to enable the dashboard.
# If omitted, /fps/dashboard returns 503.
dashboard:
  username: "admin"
  password: "admin"

# Management endpoints.
management:
  path_prefix: "/fps"  # URL prefix for management endpoints
